<!DOCTYPE html>
<html>

  <head>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6195355-4', 'yubico.com');
  ga('send', 'pageview');

</script>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="yubikey-val : YubiKey OTP Validation Server" />

    <link rel="stylesheet" type="text/css" media="screen" href="/stylesheets/stylesheet.css">

    <title>yubikey-val</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
        <span class="breadcrumb">
          <a href="/">Software listing</a>
          /
          <a href="/yubikey-val/">yubikey-val</a>
          /
          <a>ServerReplicationProtocol</a>
          </span>
          <a id="forkme_banner" href="https://github.com/Yubico/yubikey-val">View on GitHub</a>
<a id="travis_link" href="https://travis-ci.org/Yubico/yubikey-val"><img id="travis_img" src="https://travis-ci.org/Yubico/yubikey-val.svg?branch=master"/></a>
          <h1><a id="project_title" href="/yubikey-val/">yubikey-val</a></h1>
          <h2 id="project_tagline">YubiKey OTP Validation Server</h2>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>This document describes the server to server protocol.  Its purpose is
to synchronize the last used session and use counter between multiple
validation servers.</p></div>
<div class="paragraph"><p>Multiple validations servers are connected together so that each
validation server can talk to any of the other validation server using
the Server Replication Protocol.  The validation servers are
authenticated by the use of certificates.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>val A  &lt;-&gt;  val B &lt;-&gt; val C &lt;-&gt; val A</code></pre>
</div></div>
<div class="paragraph"><p>See the ValidationProtocolV20 for definition of the client to server
protocol.  The protocol described here is the server to server
protocol.  See ValidationServerAlgorithm for a description of the
implementation algorithm that uses this protocol.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_sync_request_specification">Sync request specification</h2>
<div class="sectionbody">
<div class="paragraph"><p>A sync request is issued with a HTTP get call, like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>https://apiX.yubico.com/wsapi/sync?otp=xyz&amp;modified=1264430686&amp;nonce=foobar&amp;yk_identity=foo&amp;yk_counter=42&amp;yk_use=17&amp;yk_high=10&amp;yk_low=5</code></pre>
</div></div>
<div class="paragraph"><p>The following parameters are used</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="33%" />
<col width="33%" />
<col width="33%" />
<thead>
<tr>
<th align="left" valign="top"> parameter </th>
<th align="left" valign="top">type </th>
<th align="left" valign="top">values</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">otp</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">one-time password (for logging purposes)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">modified</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">unix timestamp of when OTP was received</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">nonce</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">nonce from client request</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">yk_identity</p></td>
<td align="left" valign="top"><p class="table">modhex</p></td>
<td align="left" valign="top"><p class="table">YubiKey OTP identity in question</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">yk_counter</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">last seen session counter by sender</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">yk_use</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">last seen session use by sender</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">yk_high</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">OTP internal high time value</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">yk_low</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">OTP internal low time value</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Input values for yk_counter, yk_use, yk_high and yk_low are always
positive except for -1 which indicates that the requesting server did
not have any earlier information about the !YubiKey.</p></div>
<div class="paragraph"><p>An example response is</p></div>
<div class="literalblock">
<div class="content">
<pre><code>modified=1264430686
nonce=aspodkaaspdokas
yk_identity=cccccccccccf
yk_counter=api2 session counter
yk_use=api2 session use counter
yk_high=value
yk_low=value</code></pre>
</div></div>
<div class="paragraph"><p>The values returned are:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="33%" />
<col width="33%" />
<col width="33%" />
<thead>
<tr>
<th align="left" valign="top"> parameter </th>
<th align="left" valign="top">type </th>
<th align="left" valign="top">values</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">modified</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">timestamp of when last OTP was received</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">nonce</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">nonce from client for last OTP</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">yk_identity</p></td>
<td align="left" valign="top"><p class="table">modhex</p></td>
<td align="left" valign="top"><p class="table">YubiKey OTP identity in question</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">yk_counter</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">last seen session counter</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">yk_use</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">last seen session use</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">yk_high</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">last seen high time value</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">yk_low</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">last seen low time value</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Output values for modified, yk_counter, yk_use, yk_high and yk_low are
always positive except for -1 which indicates that the server did not
have any earlier information about the !YubiKey.  In this case, nonce
is a newly allocated random nonce.</p></div>
</div>
</div>

</section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
<footer class="inner">
<p class="copyright">yubikey-val maintained by <a href="https://github.com/Yubico">Yubico</a></p>
</footer>
</div></body></html>
