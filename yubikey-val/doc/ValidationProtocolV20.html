<!DOCTYPE html>
<html>

  <head>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6195355-4', 'yubico.com');
  ga('send', 'pageview');

</script>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="yubikey-val : YubiKey OTP validation server in PHP" />

    <link rel="stylesheet" type="text/css" media="screen" href="/stylesheets/stylesheet.css">

    <title>yubikey-val</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
        <span class="breadcrumb">
          <a href="/">Software listing</a>
          /
          <a href="/yubikey-val/">yubikey-val</a>
          /
          <a>ValidationProtocolV20</a>
          </span>
          <a id="forkme_banner" href="https://github.com/Yubico/yubikey-val">View on GitHub</a>
<a id="travis_link" href="https://travis-ci.org/Yubico/yubikey-val"><img id="travis_img" src="https://travis-ci.org/Yubico/yubikey-val.svg?branch=master"/></a>
          <h1><a id="project_title" href="/yubikey-val/">yubikey-val</a></h1>
          <h2 id="project_tagline">YubiKey OTP validation server in PHP</h2>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>All requests are HTTP GET requests. As such, all parameters must be
properly URL encoded.  In particular, some base64 characters (such as
"+") in the value fields needs to be escaped.</p></div>
<div class="paragraph"><p>Each response sent by the server is signed.  To verify that the
response has not been tampered with, clients either verify the HMAC
signature or use HTTPS connections (and verify the server
certificate).</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_generating_signatures">Generating signatures</h2>
<div class="sectionbody">
<div class="paragraph"><p>The protocol uses HMAC-SHA-1 signatures. The HMAC key to use is the
client API key.</p></div>
<div class="paragraph"><p>Generate the signature over the parameters in the message.  Each
message contains a set of key/value pairs, and the signature is always
over the entire set (excluding the signature itself), and sorted in
alphabetical order of the keys. More precisely, to generate a message
signature do:</p></div>
<div class="ulist"><ul>
<li>
<p>
Alphabetically sort the set of key/value pairs by key order.
</p>
</li>
<li>
<p>
Construct a single line with each ordered key/value pair concatenated using <em>&amp;</em>, and each key and value contatenated with <em>=</em>. Do not add any linebreaks. Do not add whitespace. For example: <code>a=2&amp;b=1&amp;c=3</code>.
</p>
</li>
<li>
<p>
Apply the HMAC-SHA-1 algorithm on the line as an octet string using the API key as key.
</p>
</li>
<li>
<p>
Base 64 encode the resulting value according to RFC 4648, for example, <code>t2ZMtKeValdA+H0jVpj3LIichn4=</code>.
</p>
</li>
<li>
<p>
Append the value under key <em>h</em> to the message.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_verifying_signatures">Verifying signatures</h2>
<div class="sectionbody">
<div class="paragraph"><p>To verify a signature on a response message, follow the same procedure
that was used to sign the response message and compare the signature
in the response to the signature you generated.  If the signature
values are equal, the signature is correct.  Make sure you remove the
signature itself from the values you generate the signature over for
verification. If the incoming message is</p></div>
<div class="literalblock">
<div class="content">
<pre><code>b=1&amp;a=2&amp;c=3&amp;h=V5FkMYr9GCG9tQA9ihuuybWl99U=</code></pre>
</div></div>
<div class="paragraph"><p>make sure to remove h before verifying:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>b=1&amp;a=2&amp;c=3</code></pre>
</div></div>
<div class="paragraph"><p>Don&#8217;t forget to sort the key/value pairs.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_verification">Verification</h2>
<div class="sectionbody">
<div class="paragraph"><p>There is one call to verify YubiKey OTPs: verify.</p></div>
<div class="paragraph"><p>The verify call lets you check whether an OTP is valid.  Since the OTP
itself contains identification information, all you have to do is to
send the OTP.</p></div>
<div class="paragraph"><p>To avoid cut&#8217;n'paste attacks, the client MUST verify that the "otp" in
the response is the same as the "otp" supplied in the request.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_request">Request</h2>
<div class="sectionbody">
<div class="paragraph"><p>Construct an HTTP GET call to</p></div>
<div class="paragraph"><p>```
<a href="http://api.yubico.com/wsapi/2.0/verify">http://api.yubico.com/wsapi/2.0/verify</a>
```</p></div>
<div class="paragraph"><p>with the following parameters (note that this request need not be signed):</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">parameter</p></td>
<td align="left" valign="top"><p class="table">type</p></td>
<td align="left" valign="top"><p class="table">required</p></td>
<td align="left" valign="top"><p class="table">purpose</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">id</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">Yes</p></td>
<td align="left" valign="top"><p class="table">Specifies the requestor so that the end-point can retrieve correct shared secret for signing the response.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">otp</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">Yes</p></td>
<td align="left" valign="top"><p class="table">The OTP from the YubiKey.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">h</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">No</p></td>
<td align="left" valign="top"><p class="table">The optional HMAC-SHA1 signature for the request.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">timestamp</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">No</p></td>
<td align="left" valign="top"><p class="table">Timestamp=1 requests timestamp and session counter information in the response</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">nonce</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">Yes</p></td>
<td align="left" valign="top"><p class="table">A 16 to 40 character long string with random unique data</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">sl</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">No</p></td>
<td align="left" valign="top"><p class="table">A value 0 to 100 indicating percentage of syncing required by client, or strings "fast" or "secure" to use server-configured values; if absent, let the server decide</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">timeout</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">No</p></td>
<td align="left" valign="top"><p class="table">Number of seconds to wait for sync responses; if absent, let the server decide</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>An example request:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>http://api.yubico.com/wsapi/2.0/verify?otp=vvvvvvcucrlcietctckflvnncdgckubflugerlnr&amp;id=87&amp;timeout=8&amp;sl=50&amp;nonce=askjdnkajsndjkasndkjsnad</code></pre>
</div></div>
<div class="paragraph"><p>And if you require additional information on timestamp and session
counters:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>http://api.yubico.com/wsapi/2.0/verify?id=87&amp;otp=vvvvvvcucrlcietctckflvnncdgckubflugerlnr&amp;timeout=8&amp;sl=50&amp;nonce=askjdnkajsndjkasndkjsnad&amp;timestamp=1</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_response">Response</h2>
<div class="sectionbody">
<div class="paragraph"><p>The verification response tells you whether the OTP is valid.  The
response has the following values:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="33%" />
<col width="33%" />
<col width="33%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">parameter</p></td>
<td align="left" valign="top"><p class="table">type</p></td>
<td align="left" valign="top"><p class="table">purpose</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">otp</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">The OTP from the YubiKey, from request</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">nonce</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">Random unique data, from request</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">h</p></td>
<td align="left" valign="top"><p class="table">string (base64)</p></td>
<td align="left" valign="top"><p class="table">Signature as described above.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">t</p></td>
<td align="left" valign="top"><p class="table">time stamp</p></td>
<td align="left" valign="top"><p class="table">Timestamp in UTC</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">status</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">The status of the operation, see below</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">timestamp</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">YubiKey internal timestamp value when key was pressed</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">sessioncounter</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">YubiKey internal usage counter when key was pressed</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">sessionuse</p></td>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">YubiKey internal session usage counter when key was pressed</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">sl</p></td>
<td align="left" valign="top"><p class="table">integer</p></td>
<td align="left" valign="top"><p class="table">percentage of external validation server that replied successfully (0 to 100)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>These are the possible "status" values in a verify response:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">name</p></td>
<td align="left" valign="top"><p class="table">meaning</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">OK</p></td>
<td align="left" valign="top"><p class="table">The OTP is valid.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">BAD_OTP</p></td>
<td align="left" valign="top"><p class="table">The OTP is invalid format.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">REPLAYED_OTP</p></td>
<td align="left" valign="top"><p class="table">The OTP has already been seen by the service.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">BAD_SIGNATURE</p></td>
<td align="left" valign="top"><p class="table">The HMAC signature verification failed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">MISSING_PARAMETER</p></td>
<td align="left" valign="top"><p class="table">The request lacks a parameter.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">NO_SUCH_CLIENT</p></td>
<td align="left" valign="top"><p class="table">The request id does not exist.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">OPERATION_NOT_ALLOWED</p></td>
<td align="left" valign="top"><p class="table">The request id is not allowed to verify OTPs.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">BACKEND_ERROR</p></td>
<td align="left" valign="top"><p class="table">Unexpected error in our server. Please contact us if you see this error.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">NOT_ENOUGH_ANSWERS</p></td>
<td align="left" valign="top"><p class="table">Server could not get requested number of syncs during before timeout</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">REPLAYED_REQUEST</p></td>
<td align="left" valign="top"><p class="table">Server has seen the OTP/Nonce combination before</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_changes_since_version_1_1">Changes since version 1.1</h2>
<div class="sectionbody">
<div class="paragraph"><p>The verify URL has changed.  In the request, the new required field
"nonce" were added, and the new optional fields "sl" and "timeout" are
added.  In the response, the new fields "otp", "nonce", and "sl" are
added.  The status codes NOT_ENOUGH_ANSWERS and REPLAYED_REQUEST were
added.</p></div>
<div class="paragraph"><p>Since both the URL and required fields has changed, version 2.0 is not
backwards compatible with version 1.1 or version 1.0.  However,
because version 2.0 use a different URL than version 1.x, the server
may support both version 1.x and version 2.0 clients at the same time.</p></div>
</div>
</div>

</section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
<footer class="inner">
<p class="copyright">yubikey-val maintained by <a href="https://github.com/Yubico">Yubico</a></p>
<p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
</footer>
</div></body></html>
