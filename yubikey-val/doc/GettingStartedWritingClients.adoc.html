<!DOCTYPE html>
<html>

  <head>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6195355-4', 'yubico.com');
  ga('send', 'pageview');

</script>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="yubikey-val : YubiKey OTP validation server in PHP" />

    <link rel="stylesheet" type="text/css" media="screen" href="/stylesheets/stylesheet.css">

    <title>yubikey-val</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
        <span class="breadcrumb">
          <a href="/">Software listing</a>
          /
          <a href="/yubikey-val/">yubikey-val</a>
          /
          <a>GettingStartedWritingClients.adoc</a>
          </span>
          <a id="forkme_banner" href="https://github.com/Yubico/yubikey-val">View on GitHub</a>
<a id="travis_link" href="https://travis-ci.org/Yubico/yubikey-val"><img id="travis_img" src="https://travis-ci.org/Yubico/yubikey-val.svg?branch=master"/></a>
          <h1><a id="project_title" href="/yubikey-val/">yubikey-val</a></h1>
          <h2 id="project_tagline">YubiKey OTP validation server in PHP</h2>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>## Introduction</p></div>
<div class="paragraph"><p>While the canonical description of the validation protocol is
documented in <a href="ValidationProtocolV20">ValidationProtocolV20</a>, it may be difficult to grasp the
high level of how a client typically works.  The intention with this
page is to illustrate one simple case.  Note that this does not cover
the replicated protocol.</p></div>
<div class="paragraph"><p>If you want to make your own client implementation, here is the
quickest way to get started:</p></div>
<div class="paragraph"><p>## API key</p></div>
<div class="paragraph"><p>API key is used to optionally sign the OTP validation request and to
verify the OTP validation response. We recommend all production
deployments use either API key or HTTPS.</p></div>
<div class="paragraph"><p>If you use HTTPS to access Yubico&#8217;s validation web service and you
validate the Yubico server SSL certificate, you don&#8217;t need to use the
shared key to further authenticate response signatures from Yubico.</p></div>
<div class="paragraph"><p>If you for some reason do not want to rely on HTTPS. You may also sign
requests using this API key.</p></div>
<div class="paragraph"><p>To get an API key, first use our online API key generator. It will
assign you an ID and create a shared key. You can use the shared key
to authenticate that the API responses do come from Yubico.</p></div>
<div class="paragraph"><p>## Capture an OTP</p></div>
<div class="paragraph"><p>Capture an OTP output from your YubiKey. You can do that by opening
a text editor and simply pressing the button on the YubiKey. The OTP is a
simple string of characters, like this:</p></div>
<div class="paragraph"><p>```
vvvvvvcurikvhjcvnlnbecbkubjvuittbifhndhn
```</p></div>
<div class="paragraph"><p>## Validate OTP format</p></div>
<div class="paragraph"><p>Prudent clients should validate the data entered by the user so that
it is what the software expects.  YubiKey OTPs consists of 32-48
characters in the ModHex alphabet <code>cbdefghijklnrtuv</code>.  Unfortunately,
this has turned to be over-aggresive because if the keyboard layout is
Dvorak-based, it will look differently.  For example, the modhex
alphabet in the US Dvorak layout is <code>jxe.uidchtnbpygk</code>.  There are
other Dvorak layouts as well.  For this reason, our recommendation is
that clients only check that the input consists of 32-48 printable
characters.</p></div>
<div class="paragraph"><p>## Send OTP to our server</p></div>
<div class="paragraph"><p>Send the authentication request to our servers following the protocol
specified below. Your request should include the verifier ID (a number
that identifies the signature key), the OTP you captured in the
previous instruction, and a random looking string of characters to
make the request unique. The request is part of the HTTP GET URL,
encoded using normal parameter/value pairs. For example (broken into
two lines for legibility):</p></div>
<div class="paragraph"><p>```
<a href="http://api2.yubico.com/wsapi/2.0/verify?id=1&amp;otp=cccccccbcjdifc">http://api2.yubico.com/wsapi/2.0/verify?id=1&amp;otp=cccccccbcjdifc</a>\
trndncchkftchjlnbhvhtugdljibej&amp;nonce=aef3a7835277a28da831005c2ae3b919e2076a62
```</p></div>
<div class="paragraph"><p>The servers that we provide are:</p></div>
<div class="paragraph"><p>```
api.yubico.com
api2.yubico.com
api3.yubico.com
api4.yubico.com
api5.yubico.com
```</p></div>
<div class="paragraph"><p>These servers are hosted in different places and by different organizations.</p></div>
<div class="paragraph"><p>## Parse response</p></div>
<div class="paragraph"><p>You will recieve a response back from the server, a string of text
that resembles the following:</p></div>
<div class="paragraph"><p>```
h=vjhFxZrNHB5CjI6vhuSeF2n46a8=
t=2010-04-23T20:34:51Z0678
otp=cccccccbcjdifctrndncchkftchjlnbhvhtugdljibej
nonce=aef3a7835277a28da831005c2ae3b919e2076a62
sl=75
status=OK
```</p></div>
<div class="paragraph"><p>You can check the authenticity of this response by checking that the
OTP and nonce was the same as the one you requested validation for and
verify the HMAC-SHA-1 signature.</p></div>
<div class="paragraph"><p>## Make a decision</p></div>
<div class="paragraph"><p>Use the <code>status=</code> codes to make a decision whether to authenticate
your user or not. All the status codes and their meanings are
described by the protocol specification, see below.</p></div>
<div class="paragraph"><p>## Binding an OTP to an Identity</p></div>
<div class="paragraph"><p>Since a valid OTP on its own is not terribly useful, you need to
connect it to a user in some way.  This is normally not something the
client needs to do, it belongs elsewhere in the application, however
for completeness we mention how it is done here.</p></div>
<div class="paragraph"><p>In some situations, the user is typing her username directly into your
application, which solves the issue.</p></div>
<div class="paragraph"><p>More generally, the YubiKey OTP contains as the initial part an
identity of the YubiKey, and it can be used to identify the user.  The
identity part is the same for every OTP, and it is the initial 2-16
modhex characters of the OTP.  (The identity can be programmed to 0
characters, but then obviously this scheme does not apply.)  Since the
rest of the OTP is always 32 characters, the method to extract the
identity is to remove 32 characters from the end and then use the
remaining string, which should be 2-16 characters, as the YubiKey
identity.</p></div>
<div class="paragraph"><p>Note that the validation server is case insensitive, so you need to
lower-case the string in order to avoid caps lock resulting in
different identities with the only differ being case of the prefix.</p></div>
<div class="paragraph"><p>Typically you would store the association between the user and the
YubiKey prefix in a database.</p></div>
<div class="paragraph"><p>## The End</p></div>
<div class="paragraph"><p>There are some more subtle matters that can be important, so please
read the entire protocol specification for all the details.  Further,
for added reliability, you may send the request in parallel to more
than one server, which is not explained above.</p></div>
</div>
</div>

</section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
<footer class="inner">
<p class="copyright">yubikey-val maintained by <a href="https://github.com/Yubico">Yubico</a></p>
<p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
</footer>
</div></body></html>
