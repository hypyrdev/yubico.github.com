<!DOCTYPE html>
<html>

  <head>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6195355-4', 'yubico.com');
  ga('send', 'pageview');

</script>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="yubico-pam : Yubico Pluggable Authentication Module (PAM)" />

    <link rel="stylesheet" type="text/css" media="screen" href="/stylesheets/stylesheet.css">

    <title>yubico-pam</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
        <span class="breadcrumb">
          <a href="/">Software listing</a>
          /
          <a href="/yubico-pam/">yubico-pam</a>
          /
          <a>YubikeyAndSSHViaPAM</a>
          </span>
          <a id="forkme_banner" href="https://github.com/Yubico/yubico-pam">View on GitHub</a>

          <h1><a id="project_title" href="/yubico-pam/">yubico-pam</a></h1>
          <h2 id="project_tagline">Yubico Pluggable Authentication Module (PAM)</h2>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>The purpose of this document is to guide readers through the configuration
steps to use two factor authentication for SSH using Yubikey. This document
assumes that the reader has advanced knowledge and experience in Linux
system administration, particularly for how PAM authentication mechanism is
configured on a Linux platform.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_details">Details</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph"><p>Successful configuration of the Yubico PAM module to support two factor
authentication requires following prerequisites:</p></div>
<div class="paragraph"><p>1)      Operating System: Any Unix operating system which supports PAM
        (Pluggable Authentication Module)
        (<a href="http://www.kernel.org/pub/linux/libs/pam/">http://www.kernel.org/pub/linux/libs/pam/</a>)</p></div>
<div class="paragraph"><p>2)      Complier : GNU GCC complier (<a href="http://gcc.gnu.org/">http://gcc.gnu.org/</a>)</p></div>
<div class="paragraph"><p>3)      Yubico Client C library version 1.5 or later
  (<a href="https://developers.yubico.com/yubico-c-client/">https://developers.yubico.com/yubico-c-client/</a>)</p></div>
<div class="paragraph"><p>4)      Yubico PAM Module: Yubico PAM Module Version 1.7 or later
  (<a href="https://developers.yubico.com/yubico-pam/">https://developers.yubico.com/yubico-pam/</a>)</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_system_requirements">System Requirements</h2>
<div class="sectionbody">
<div class="paragraph"><p>This document illustrates the configuration steps for Fedora Core 8
operating system. However, there steps should work on most other Linux
distributions.</p></div>
<div class="paragraph"><p>The Yubico PAM module for SSH can be downloaded from:</p></div>
<div class="paragraph"><p><a href="https://developers.yubico.com/yubico-pam/releases.html">https://developers.yubico.com/yubico-pam/releases.html</a></p></div>
<div class="paragraph"><p>The Yubico PAM module support two factor authentication for SSH.
The two factor authentication module verifies the user name and password
for the user and the one time password (OTP) generated by Yubikey assigned
to the user.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_build_yubico_c_client_and_pam_yubico">Build yubico-c-client and pam_yubico</h2>
<div class="sectionbody">
<div class="paragraph"><p>Build instructions for yubico-c-client are found in the README:</p></div>
<div class="paragraph"><p><a href="https://github.com/Yubico/yubico-c-client/wiki/ReadMe">https://github.com/Yubico/yubico-c-client/wiki/ReadMe</a></p></div>
<div class="paragraph"><p>Build instructions for pam_yubico are found in the README:</p></div>
<div class="paragraph"><p><a href="https://github.com/Yubico/yubico-pam/wiki/ReadMe">https://github.com/Yubico/yubico-pam/wiki/ReadMe</a></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1">
<h2 id="_configuration_for_user_and_yubikey_token_id_mapping">Configuration for user and yubikey token ID mapping:</h2>
<div class="sectionbody">
<div class="paragraph"><p>There are two ways of user and yubikey token ID mapping. It can be either
done at administrative level or at individual user level.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_1_administrative_level">1) Administrative Level:</h2>
<div class="sectionbody">
<div class="paragraph"><p>In Administrative level, system administrators hold right to configure the
user and yubikey token ID mapping. Administrators can achieve this by creating
a new file that contains information about the username and the corresponding
IDs of Yubikey(s) assigned.</p></div>
<div class="paragraph"><p>This file contains user name that is allowed to connect to the system over SSH
and the token id of the Yubikey(s) assigned to that particular user. A user
can be assigned multiple Yubikeys and this multi key mapping is supported by
this file. However, presently there is no logic coded to detect or prevent use
of same Yubikey ID for multiple users.</p></div>
<div class="paragraph"><p>Each record in the file should begin on a new line. The parameters in each
record are separated by “:” character similar to /etc/passwd.</p></div>
<div class="paragraph"><p>The contents of this file are as follows:</p></div>
<div class="paragraph"><p>&lt;user name&gt;:&lt;yubikey token ID&gt;:&lt;yubikey token ID&gt;: ….</p></div>
<div class="paragraph"><p>&lt;user name&gt;:&lt;yubikey token ID&gt;:&lt;yubikey token ID&gt;:…..</p></div>
<div class="paragraph"><p>e.g.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>   paul:indvnvlcbdre:ldvglinuddek
   simon:uturrufnjder:hjturefjtehv
   kurt:ertbhunjimko</code></pre>
</div></div>
<div class="paragraph"><p>The mapping file must be created/updated manually before configuration of
Yubico PAM module for SSH authentication.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_of_modified_pam_yubico_so_module_at_administrative_level">Configuration of modified pam_yubico.so module at administrative level:</h2>
<div class="sectionbody">
<div class="paragraph"><p>Append the following line to the beginning of /etc/pam.d/sshd file:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>   auth required pam_yubico.so id=16 debug authfile=/path/to/mapping/file</code></pre>
</div></div>
<div class="paragraph"><p>Make sure you set id=16 to the correct API-id for the yubico validation server.</p></div>
<div class="paragraph"><p>After the above configuration changes, whenever a user connects to the server
using any ssh client, the PAM authentication interface will pass the control to
Yubico PAM module. The Yubico PAM module first checks the presence of authfile
argument in PAM configuration.  If authfile argument is present, it parses the
corresponding mapping file and  verifies the username with corresponding
Yubikey token id as configured in the mapping file. If valid, the Yubico PAM
module extracts the OTP string and sends it to the Yubico authentication server
or else it reports failure.  If authfile argument is present but the mapping
file is not present at the provided path PAM module reports failure. After
successful verification of OTP Yubico PAM module from the Yubico
authentication server, a success code is returned.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_2_user_level">2) User Level:</h2>
<div class="sectionbody">
<div class="paragraph"><p>In User level, individual users have the ability to configure yubikey token
ID assigned to them. Users can achieve this by creating a new file
".yubico/authorized_yubikeys" inside their home directories that contains
information about the username and the corresponding IDs of Yubikey(s) assigned
to them. A user can be assigned multiple Yubikeys and the multi key mapping is
supported by this file.</p></div>
<div class="paragraph"><p>This file must contain only one record. The parameters in the record are
separated by “:” character similar to /etc/passwd. The contents of this file
are as shown below:</p></div>
<div class="paragraph"><p>&lt;user name&gt;:&lt;yubikey token ID&gt;:&lt;yubikey token ID&gt;: ….</p></div>
<div class="paragraph"><p>e.g.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>   paul:indvnvlcbdre:ldvglinuddek</code></pre>
</div></div>
<div class="paragraph"><p>The .yubico/authorized_yubikeys file must be created/updated manually and must
be placed inside user&#8217;s home directory before configuration of Yubico PAM
module for SSH authentication.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_of_modified_pam_yubico_so_module_at_user_level">Configuration of modified pam_yubico.so module at user level:</h2>
<div class="sectionbody">
<div class="paragraph"><p>Append the following line to the beginning of /etc/pam.d/sshd file:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>   auth required pam_yubico.so id=16 debug</code></pre>
</div></div>
<div class="paragraph"><p>After the above configuration changes, whenever a user connects to the server
using any SSH client, the PAM authentication interface will pass the control
to Yubico PAM module. The Yubico PAM module first verifies the username with
corresponding Yubikey token id as configured in the .yubico/authorized_yubikeys
file that present in the user&#8217;s home directory who is trying to assess server
through SSH. If valid, the Yubico PAM module extracts the OTP string and sends
it to the Yubico authentication server or else it reports failure. After
successful verification of OTP Yubico PAM module from the Yubico authentication
server, a success code is returned.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_3_pam_unix_so_configuration">3) pam_unix.so configuration:</h2>
<div class="sectionbody">
<div class="paragraph"><p>Append <em>try_first_pass</em> parameter to the <em>pam_unix.so</em> module to authenticate
the user with password passed from the preceding auth module.</p></div>
<div class="paragraph"><p>The <em>pam_unix.so</em> module used for authentication is generally located into
<em>"/etc/pam.d/system-auth"</em> for RedHat based Linux system and into
<em>"/etc/pam.d/common-auth"</em> for Debian based Linux systems.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_4_ssh_configuration">4) SSH configuration:</h2>
<div class="sectionbody">
<div class="paragraph"><p>Edit the sshd configuration file <em>“/etc/ssh/sshd_config”</em> to disable challenge-
response passwords. Change <em>“challenge-response passwords yes”</em> to
<em>“challenge-response passwords no”</em>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_test_setup">Test Setup:</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1">
<h2 id="_a_fedora_8">A) Fedora 8:</h2>
<div class="sectionbody">
<div class="paragraph"><p>Test setup for fedora 8 environment is as follows:</p></div>
<div class="paragraph"><p>• OS Version: Fedora release 8 (Werewolf)
• Kernel Version: Kernel version 2.6.23.1-42.fc8
• OpenSSH Version : openssh-4.7p1-2.fc8
• Yubico PAM Version: pam_yubico-1.7</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_b_fedora_6">B) Fedora 6:</h2>
<div class="sectionbody">
<div class="paragraph"><p>Test setup for fedora 6 environment is as follows:</p></div>
<div class="paragraph"><p>• OS Version: Fedora Core release 6 (Zod)
• Kernel Version: Kernel version 2.6.18-1.2798.fc6
• OpenSSH Version : openssh-4.3p2-10
• Yubico PAM Version: pam_yubico-1.7</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_pam_configuration">PAM configuration:</h2>
<div class="sectionbody">
<div class="paragraph"><p>PAM configuration files in our testing environment are as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
/etc/pam.d/sshd:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>    auth           required      pam_yubico.so authfile=/etc/yubikeyid id=16 debug
    auth           include       system-auth
    account        required      pam_nologin.so
    account        include       system-auth
    password       include       system-auth
    session        optional      pam_keyinit.so force revoke
    session        include       system-auth
    session        required      pam_loginuid.so</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
/etc/yubikeyid:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>    root:indvnvlcbdre:ldvglinuddek
    test:ldvglinuddek</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
/root/.yubico/authorized_yubikeys:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>    root:indvnvlcbdre:ldvglinuddek</code></pre>
</div></div>
<div class="paragraph"><p>Please change PAM configuration settings for SSH as shown above and test the
configuration.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_the_configuration">Testing the Configuration:</h2>
<div class="sectionbody">
<div class="paragraph"><p>We assume that you have “root” and “test” user configured to access SSH on your
test environment with password “secret” and “pencil” respectively.</p></div>
<div class="paragraph"><p>Use any standard SSH client for testing (We used SSH command line utility).</p></div>
<div class="paragraph"><p>Try to login to server with SSH client as configured user:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  $ ssh -l test localhost
  Password: (enter 'pencil' and touch the ldvglinuddek yubikey)</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code>  $ ssh -l root localhost
  Password: (enter 'secret' and touch the ldvglinuddek yubikey)</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code>  $ ssh -l root localhost
  Password: (enter 'secret' and touch the indvnvlcbdre yubikey)</code></pre>
</div></div>
</div>
</div>

</section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
<footer class="inner">
<p class="copyright">yubico-pam maintained by <a href="https://github.com/Yubico">Yubico</a></p>
<p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
</footer>
</div></body></html>
